
<html>
	<head>
		<title>Demo</title>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript">
			json="";
			function getJson()
			{
				var urls= "http://203.113.130.218:50080/dtdl/api/get_category.php";
				console.log("url: " + urls );
				//alert(urls);
				$.ajax({// cau lenh ajax POST vs usernam password
				dataType: "json",
				url: urls,
				type: "GET",
				success: function( data){ // get read data from json to database with nameTable MARKSTUDENT
					console.log(data);
					//var	myJSONText	=	JSON.stringify(data,replacer);
					json=data;
					startCreate();
				},
				error: function(xhr, textStatus, error){
					alert("Erorr mark");
				}
				});// end ajax
				
			}
			function startCreate() {
				var db = window.openDatabase("Database", "1.0", "PhoneGap Demo", 2000000);
				db.transaction(createTable, errorCB);
				console.log("B0");
			}
			
			
			function createTable(tx) {
				tx.executeSql('DROP TABLE IF EXISTS DEMO');
				tx.executeSql('CREATE TABLE IF NOT EXISTS DEMO (id int,parent_id id, title text)');
				
				// loop to read data from jsonObject to create table
				console.log("B1");
				for (var i in json){
						tx.executeSql('INSERT INTO DEMO (id, parent_id,title) VALUES ('+json[i].id+','+json[i].parent_id+',"'+json[i].title+'")');
						console.log("jsonmarkstudent");
						console.log(json[i].id + "  " + json[i].parent_id + "   " + json[i].title);
						

				}// end for 
				console.log("B2");
			}//
			
			function errorCB(err) {
				console.log("Error processing SQL 1: "+err.code);
			}
			
			//-----------------
			// read from data base
			function readDatabases() {
				var db = window.openDatabase("Database", "1.0", "PhoneGap Demo", 2000000);
				db.transaction(queryDB, errorRead);
			}
			
			function queryDB( tx )
			{
				tx.executeSql('SELECT * FROM DEMO', [], querySuccess, errorCB);
			}
			
			function querySuccess( tx,results )
			{
				var len = results.rows.length;
				console.log("MARKSTUDENT table: " + len + " rows found.");
				for( var i = 0; i < len; i++)
				{
					console.log("Row " + (i+1));
					console.log( results.rows.item(i).id + "   " + results.rows.item(i).parent_id + "   " + results.rows.item(i).title);
				}
			}
			
			function errorRead( error)
			{
				Console.log("errorRead : " + error.code );
			}
		</script>
	</head>
	
	<body>
			<button onclick="getJson()">GetJson</button>
			<button onclick="readDatabases()">Show data</button>
	</body>
</html>